<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>P2P Averaging · ACiD.jl</title><meta name="title" content="P2P Averaging · ACiD.jl"/><meta property="og:title" content="P2P Averaging · ACiD.jl"/><meta property="twitter:title" content="P2P Averaging · ACiD.jl"/><meta name="description" content="Documentation for ACiD.jl."/><meta property="og:description" content="Documentation for ACiD.jl."/><meta property="twitter:description" content="Documentation for ACiD.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ACiD.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ACiD.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../installation_mpiexecjl/">Install mpiexecjl</a></li></ul></li><li><span class="tocitem">Resources</span><ul><li><a class="tocitem" href="../api/">Documentation</a></li><li><a class="tocitem" href="../p2p_sync/">P2P Sync</a></li><li class="is-active"><a class="tocitem" href>P2P Averaging</a><ul class="internal"><li><a class="tocitem" href="#Index"><span>Index</span></a></li><li><a class="tocitem" href="#Public-Interface"><span>Public Interface</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Resources</a></li><li class="is-active"><a href>P2P Averaging</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>P2P Averaging</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jakubpeleska/ACiD.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jakubpeleska/ACiD.jl/blob/main/docs/src/p2p_averaging.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="P2P-Averaging"><a class="docs-heading-anchor" href="#P2P-Averaging">P2P Averaging</a><a id="P2P-Averaging-1"></a><a class="docs-heading-anchor-permalink" href="#P2P-Averaging" title="Permalink"></a></h1><p>Documentation of <code>p2p_averaging</code> submodule&#39;s interface.</p><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="#ACiD.gossip_process"><code>ACiD.gossip_process</code></a></li><li><a href="#ACiD.synchronize!"><code>ACiD.synchronize!</code></a></li></ul><h2 id="Public-Interface"><a class="docs-heading-anchor" href="#Public-Interface">Public Interface</a><a id="Public-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Public-Interface" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ACiD.synchronize!" href="#ACiD.synchronize!"><code>ACiD.synchronize!</code></a> — <span class="docstring-category">Function</span></header><section><div><p><strong>The synchronize function.</strong></p><p>Expects that the peer with whom we communicate runs the same synchronize function. The p2p communication edits in-place the values of the parameters params<em>com and params</em>com<em>tilde (if apply</em>acid).</p><p>Parameters:</p><ul><li>params_com (torch.tensor): 1D tensor containing the model&#39;s parameters.</li><li>params_other_worker (torch.tensor): 1D tensor, placeholder to receive the <code>params_com</code> of the worker with whom we communicate.</li><li>process_group (a torch distributed <code>process_group</code>): specifies the <code>process_group</code> to use for the p2p communications.</li><li>other_rank (int): the rank of the worker we communicate with.</li><li>apply_acid (bool): whether or not to apply ACiD momentum. If true, the communication is an &quot;event&quot; triggering a momentum update.</li><li>params_com_tilde (torch.tensor): &quot;momentum&quot; variable, same size as <code>params_com</code>, mixing with <code>params_com</code> to obtain acceleration.</li><li>ode_matrix (torch.tensor): a 2x2 matrix storing the parameters of the linear mixing between params and <code>params_tilde</code>.</li><li>t_last_spike (float): time of the last local update to <code>params_com</code> (be it a communication or gradient one).</li><li>delta_t_grad (mp.Value storing a double): the variable keeping track of the time that it takes to make a grad step.</li><li>beta_tilde (float): the α̃ value to use in ACiD.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakubpeleska/ACiD.jl/blob/ae62f60b30d6c3b59d9b171939013d6263cc4bf6/src/p2p_averaging.jl#L45-L61">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ACiD.gossip_process" href="#ACiD.gossip_process"><code>ACiD.gossip_process</code></a> — <span class="docstring-category">Function</span></header><section><div><p><strong>Gossip routine for the p2p averaging of the model&#39;s parameters running in the background.</strong></p><ul><li>Average the parameters of all the workers at the beginning (to start from a common initialization), and at the end.</li><li>Use the mp.Variable <code>rank_other</code> to communicate with the orchestring process   that pairs available workers together to perform p2p communications, allowing this   function to know with which rank to communicate next.</li><li>Depending on <code>deterministic_com</code>, implement or not a P.P.P for the communication process:   if true, a random number of p2p communications between 2 grad steps are done, following a poisson law.</li><li>When the orchestrating process counted that the right number of grad step have been performed in total,   signal it back to this process (stops the communication routine), which signals to the main process to stop performing grad steps.</li></ul><p>Parameters:</p><ul><li>rank (int): our rank id in the distributed setting.</li><li>local_rank (int): the local rank of the worker inside its compute node (to create a Cuda Stream in the right GPU).</li><li>world_size (int): the total number of workers.</li><li>rank_other (mp.Value): a multiprocessing Value to store the id of the rank of the next communication. It is updated                           by the orchestrating process pairing workers together, and re-initialized by this one after a communication.                           if <code>rank_other.value</code> == -1: (base value) no peer has been found yet.                           if <code>rank_other.value</code> == -2: signal from the orchestrating process that enough gradients have been computed in total,                                                   stops the communication process.                           if <code>rank_other.value</code> not in [-1, -2]: contains the rank of the worker we are supposed to communicate with next.</li><li>params_com (torch.tensor): 1D tensor containing the model&#39;s parameters.</li><li>params_other (torch.tensor): 1D tensor, placeholder to receive the <code>params_com</code> of the worker with whom we communicate.</li><li>barrier_sync_averaging (mp.Barrier): a barrier used to communicate with the synchronization process.                                       When we meet this barrier, we signal to the sync process that we finished our previous communication,                                       and are available for the next one, so that it can begin to look for another available peer to connect                                       to for the next p2p communication.</li><li>continue_grad_routine (mp.Value containing a bool): whether or not the grad process should continue.                                                       Initialized at 1 (true). Is put to 0 (False) when the orchestrating                                                       process signals to us that the total number of gradients quota has been met.</li><li>barrier_end_init (mp.Barrier): a barrier to signal to the __init__ function of ADP&#39;s class that the initializing average of the parameters                                   has been performed, and that ADP can resume its init.</li><li>barrier_com_grad (mp.Barrier): a barrier to make sure a certain amount of communication has been made between 2 grads.                                   Also used to make sure a certain amount of grad have been performed between 2 comm if <code>rate_com</code> &lt; 1.</li><li>log (logger): to print messages in the logs if needed.</li><li>com_history (list of mp.Value): list of size <code>world_size</code>. Used to logg how many times this worker communicated with each of its peers.</li><li>count_coms_local (mp.Value): a count of the number of p2p communications this worker has done.</li><li>rate_com (float): the rate at which p2p communications are done (in expectation) compared to local grad steps.</li><li>apply_acid (bool): whether or not to apply ACiD momentum. If True, the communication is an &quot;event&quot; triggering a momentum update.</li><li>params_com_tilde (torch.tensor): &quot;momentum&quot; variable, same size as <code>params_com</code>, mixing with <code>params_com</code> to obtain acceleration.</li><li>ode_matrix (torch.tensor): a 2x2 matrix storing the parameters of the linear mixing between params and <code>params_tilde</code>.</li><li>t_last_spike (float): time of the last local update to <code>params_com</code> (be it a communication or gradient one).</li><li>delta_t_grad (mp.Value storing a double): the variable keeping track of the time that it takes to make a grad step.</li><li>beta_tilde (float): the α̃ value to use in ACiD.</li><li>deterministic_com (bool): whether or not to schedule to use Poisson Point Processes for the communications.                           if True, a random number of p2p communications between 2 grad steps are done, following a poisson law.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakubpeleska/ACiD.jl/blob/ae62f60b30d6c3b59d9b171939013d6263cc4bf6/src/p2p_averaging.jl#L130-L178">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../p2p_sync/">« P2P Sync</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Thursday 15 February 2024 04:48">Thursday 15 February 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
