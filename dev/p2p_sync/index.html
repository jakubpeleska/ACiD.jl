<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>P2P Sync · ACiD.jl</title><meta name="title" content="P2P Sync · ACiD.jl"/><meta property="og:title" content="P2P Sync · ACiD.jl"/><meta property="twitter:title" content="P2P Sync · ACiD.jl"/><meta name="description" content="Documentation for ACiD.jl."/><meta property="og:description" content="Documentation for ACiD.jl."/><meta property="twitter:description" content="Documentation for ACiD.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ACiD.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ACiD.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../installation_mpiexecjl/">Install mpiexecjl</a></li></ul></li><li><span class="tocitem">Resources</span><ul><li><a class="tocitem" href="../api/">Documentation</a></li><li class="is-active"><a class="tocitem" href>P2P Sync</a><ul class="internal"><li><a class="tocitem" href="#Index"><span>Index</span></a></li><li><a class="tocitem" href="#Public-Interface"><span>Public Interface</span></a></li></ul></li><li><a class="tocitem" href="../p2p_averaging/">P2P Averaging</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Resources</a></li><li class="is-active"><a href>P2P Sync</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>P2P Sync</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jakubpeleska/ACiD.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jakubpeleska/ACiD.jl/blob/main/docs/src/p2p_sync.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="P2P-Sync"><a class="docs-heading-anchor" href="#P2P-Sync">P2P Sync</a><a id="P2P-Sync-1"></a><a class="docs-heading-anchor-permalink" href="#P2P-Sync" title="Permalink"></a></h1><p>Documentation of <code>p2p_sync</code> submodule&#39;s interface.</p><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="#ACiD.listen_given_rank"><code>ACiD.listen_given_rank</code></a></li><li><a href="#ACiD.master_process"><code>ACiD.master_process</code></a></li><li><a href="#ACiD.sync_process"><code>ACiD.sync_process</code></a></li></ul><h2 id="Public-Interface"><a class="docs-heading-anchor" href="#Public-Interface">Public Interface</a><a id="Public-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Public-Interface" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ACiD.sync_process" href="#ACiD.sync_process"><code>ACiD.sync_process</code></a> — <span class="docstring-category">Function</span></header><section><div><p><strong>Process run by every worker in the background.</strong></p><p>This process allows each worker to communicate with the &quot;orchestrating&quot; master process (hosted by worker 0). The goal is to signal to the master process when this worker is available for communication, and to gather from the master process the rank of the peer with which we are supposed to communicate. When received, this information <code>rank_other</code> is sent to the p2p_averaging process run in parallel in this worker, so that the p2p averaging process knows with which worker to communicate next. This process will communicate with one of the <code>world_size</code> &quot;listen_given_rank&quot; processes hosted at worker 0, which has <code>world_size + 1</code> processes run in parallel:     * one to <code>listen_to</code> each one of the sync<em>process run by each worker.     * one &quot;orchestrating&quot; process, dedicated to make pairs of workers. So, in total, there are `2*world</em>size + 1` processes that need to communicate with each other (only sending ints), so initialize a process_group using gloo backend here.</p><p>Parameters:</p><ul><li>rank (int): our rank id in the distributed setting.</li><li>world_size (int): the total number of workers.</li><li>rank_other (mp.Value): a multiprocessing Value to store the id of the rank of the next communication.                           It is updated here, based on the information given by the master process, to signal to the p2p_averaging process                           run in parallel in this worker which peer to communicate wiith next.                           if <code>rank_other.value</code> == -2: signal from the orchestrating process that enough gradients have been computed in total,                                                   stops the communication process.</li><li>new_grads (mp.Value): a multiprocessing Value updated by the process and the main one, counting how many new grad steps have been performed                       by this worker since last communication. This is used by the master process to count the total number of grad done,                       and initiate the &quot;kill&quot; of all processes when the right amount of grad steps have been performed in total.</li><li>barrier_sync_averaging (mp.Barrier): a barrier used to communicate with the p2p_averaging process.                                       When the averaging process meets this barrier, it signals to this process that the worker                                       is available for the next communication, so we can begin to look for another available peer to connect                                       to by sending our rank information to the master process which will realize the pairing.</li><li>log (logger): to print messages in the logs if needed.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakubpeleska/ACiD.jl/blob/11830415dbcc0f577dccf007d584d7916448b203/src/p2p_sync.jl#L21-L49">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ACiD.listen_given_rank" href="#ACiD.listen_given_rank"><code>ACiD.listen_given_rank</code></a> — <span class="docstring-category">Function</span></header><section><div><p><strong>Process run in the background of worker 0.</strong></p><p>Its goal is to listen to one specific worker (specifically, its &quot;sync_process&quot; process), and to send it information coming from the orchestrating process also hosted by worker 0. The main goal of this function is to put to the mp.Queue the rank of the worker it is listening to when this worker sent, through its &quot;sync_process&quot; function, the signal that its corresponding worker was available for a communication. Then, as this mp.Queue is shared with the orchestrating process, the orchestrating process can receive the information and pair the worker with another one.</p><p>Parameters:</p><ul><li>rank (int): our rank id in the distributed setting.</li><li>world_size (int): the total number of workers.</li><li>queue (mp.Queue): queue containing the ranks of all available workers for communication.                   The orchestrating process then only needs to &quot;de-queue&quot; the ranks to make pairs, insuring that the communications are performed in FIFO style,                   minimizing latency.</li><li>nb_grad_tot_so_far (mp.Value): int storing the global count of grads (total number of gradients taken by all workers).                                   This value is updated by adding to it the &quot;new_grads&quot; (see &quot;sync_process&quot; doc) from every worker.                                   This mp.Value is thus updated by world_size &quot;listen_given_rank&quot; processes, and used by the orchestrating process to kill all processes                                   when the target number of grads is reached.</li><li>lock (mp.Lock): multiprocessing lock to make sure that the nb_grad_tot_so_far is edited by only one process at a time, so that no &quot;new gradients&quot; are thrown out                   by a multiprocessing bug.</li><li>log (logger): to print messages in the logs if needed.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakubpeleska/ACiD.jl/blob/11830415dbcc0f577dccf007d584d7916448b203/src/p2p_sync.jl#L91-L111">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ACiD.master_process" href="#ACiD.master_process"><code>ACiD.master_process</code></a> — <span class="docstring-category">Function</span></header><section><div><p><strong>Orchestrating process hosted on worker 0.</strong></p><p>This process accomplishes 2 things:</p><ul><li>Group available workers by pairs for p2p communication, according to the given graph topology, and trying to minimize latency   by pairing together workers that were the first to be available to communicate.</li><li>Signal to all processes when the target number of grads have been reached, so that computations &amp; communication can stop.</li></ul><p>Parameters:</p><ul><li>world_size (int): the total number of workers.</li><li>∇max_steps (int): The target number of total nb of grads performed by all workers.                           When it is reached, this process sends the signal to all other to stop all computations &amp; communications.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakubpeleska/ACiD.jl/blob/11830415dbcc0f577dccf007d584d7916448b203/src/p2p_sync.jl#L137-L148">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../api/">« Documentation</a><a class="docs-footer-nextpage" href="../p2p_averaging/">P2P Averaging »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Thursday 15 February 2024 08:24">Thursday 15 February 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
